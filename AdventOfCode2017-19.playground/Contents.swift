//: Playground - noun: a place where people can play

import Foundation

let input = """
                                                                                         |                                                                                                               
   +-------+                                         +-+ +-------------------------------------------------------------------------+   +-+   +-----------------------------------------+   +-+   +---+   
   |       |                                         | | |                               |                                         |   | |   |                                         |   | |   |   |
   |       |                                         | +-|---------------+       +---------+   +---------------------------------------|---------------------------+                   |   | |   |   |   
   |       |                                         |   |               |       |       | |   |                                   |   | |   |                     |                   |   | |   |   |   
   |       |                                         |   +-------------------------------|-----------------------------------------|---|-|---|---------------------|-----------------+ |   | |   |   |   
   |       |                                         |                   |       |       | |   |                                   |   | |   |                     |                 | |   | |   |   |   
   |       |                                   +-------+   +-----------+ |       +-----+ | |   |                 +---------------+ |   | |   |     +---------------+       +---------+ |   | |   |   |   
   |       |                                   |     | |   |           | |             | | |   |                 |               | |   | |   |     |                       |           |   | |   |   |   
   |   +---------------------------------------------|-----------------|-|-----+       | | |   |                 +---------------|-|---------------|-------------------+   |           |   | |   |   |   
   |   |   |                                   |     | |   |           | |     |       | | |   |                                 | |   | |   |     |                   |   |           |   | |   |   |   
   +-------|-----+                             |     | |   |     +---------------------|---|---|-----------------------------------|-+ | |   |     |                   |   |           |   | |   |   |   
       |   |     |                             |     | |   |     |     | |     |       | | |   |                                 | | | | |   |     |                   |   |           |   | |   |   |   
   +-+ |   +-----------------------------------------------------|-----|-|-------------|-|-|---|---------------------------------|-|-|-|-|---|-----|-------------------|---|-----+     |   | |   | +---+ 
   | | |         |                             |     | |   |     |     | |     |       | | |   |                                 | | | | |   |     |                   |   |     |     |   | |   | | | | 
   | | |         |     +-----------------------|-----|-----------|-----|-|-----|---------|---------------------------+       +---+ +-|-|-----------|-----------+ +-----+   |     |     |   | |   +-|-|-+ 
   | | |         |     |                       |     | |   |     |     | |     |       | | |   |                     |       |       | | |   |     |           | |         |     |     |   | |     | |   
   | | +---------|-----------------------------------|-----|-----|-----|-----------------|-|-------------------------|-------|---------|-|-+ |     | +-----+   | |         |     |     |   | |     | |   
   | |           |     |                       |     | |   |     |     | |     |       | | |   |                     |       |       | | | | |     | |     |   | |         |     |     |   | |     | |   
   | |           |     |   +-------+           |     | |   |     +-----------------------|-----|-+                   |       |       | | | | |     | |     |   | |         |     |     |   | | +---+ |   
   | |           |     |   |       |           |     | |   |           | |     |       | | |   | |                   |       |       | | | | |     | |     |   | |         |     |     |   | | |     |   
   | |           |     |   |       |           |     | |   |           | |     |       | | |   | |                   |       |       | | | | |     | |     |   | |         |     |     |   | | |     |   
   | |           |     |   |       |           |     | |   |           | |     |       | | |   | |                   |       |       | | | | |     | |     |   | |         |     |     |   | | |     |   
   | |           |     |   |       |           |     | |   | +-----------|-----|-----------|---|-+                   |       |     +---|-------------|---------|-----------------------|---|---|-------+ 
   | |           |     |   |       |           |     | |   | |         | |     |       | | |   |                     |       |     | | | | | |     | |     |   | |         |     |     |   | | |     | | 
   | |           |     |   |       |           |     | |   | |         | |     |       +-|-----------------------------------------|-+ | | | |     | +-----|---|-----+     |     |     |   | | |     | | 
   | |           |     |   |       |           |     | |   | |         | |     |         | |   |                     |       |     |   | | | |     |       |   | |   |     |     |     |   | | |     | | 
   | |       +---------|-----------|-----------|-----|-----|-----------|---------------+ | |   |                     |       |     | +---|-|---------------|---|-|---+     |     +---+ |   | | |     | | 
   | |       |   |     |   |       |           |     | |   | |         | |     |       | | |   |                     |       |     | | | | | |     |       |   | |         |         | |   | | |     | | 
   | |       |   | +---|-------+   +-----------------|-----|-|---------+ |     |       | | |   |                     |       |     | | | | | |   +-------------|-|---------+         | |   | | |     | | 
   | |       |   | |   |   |   |               |     | |   | |           |     |       | | |   |                     |       |     | | | | | |   | |       |   | |                   | |   | | |     | | 
   | |       |   | |   |   |   |               |     | |   | |           |     |       | | |   |                     |       |     | | | | | |   | +---+ +-------|-+                 | |   | | |     | | 
   | |       |   | |   |   |   |               |     | |   | |           |     |       | | |   |                     |       |     | | | | | |   |     | | |   | | |                 | |   | | |     | | 
   | |       |   | |   |   |   |               |     | |   | |         +-------|-------|-|-|-------------+           |       |     | | | | | | +-|-+   | | |   | | +-+ +-------+   +-------|---|---+ | | 
   | |       |   | |   |   |   |               |     | |   | |         | |     |       | | |   |         |           |       |     | | | | | | | | |   | | |   | |   | |       |   | | |   | | |   | | | 
   | |       |   | |   |   |   |               |     | |   | |         | |     +-----+ | +---------------|-----*-------------|-----------|---|-|-|-|-------|---|---+ +---------------+ |   | | |   | | |
   | |       |   | |   |   |   |               |     | |   | |         | |           | |   |   |         |           |       |     | | | | | | | | |   | | |   | | |   |       |   |   |   | | |   | | | 
   | |       | +-|-----|-------------------+   |     | |   | |         | |           | |   |   |         |   +-------|-------------|---|-|-|---+ | |   | | |   | | |   |       +-----------|---|-+ | | | 
   | |       | | | |   |   |   |           |   |     | |   | |         | |           | |   |   |         |   |       |       |     | | | | | |   | |   | | |   | | |   |           |   |   | | | | | | | 
   | |       | | | |   | +---------------------+     | |   | |       +-+ |         +-------|---|-----------------+   |       |     | | | | | |   | |   | | |   | | |   |           |   |   | | | | | | | 
   | |       | | | |   | | |   |           |         | |   | |       |   |         | | |   |   |         |   |   |   |       |     | | | | | |   | |   | | |   | | |   |           |   |   | | | | | | | 
   | |       | | | |   | | |   |     +-----|------L--|-------------------|-------------|---|---------------------|---|-------|---+ | | | | | | +-------|-+ |   | | |   |       +-----------+ | | | | | | 
   | |       | | | |   | | |   |     |     |         | |   | |       |   |         | | |   |   |         |   |   |   |       |   | | | | | | | | | |   |   |   | | |   |       |   |   |     | | | | | | 
   | |   +---------------------------------|-----------|---|-----------------------|-------|---|---------|---|---------------|---------|-|---|---|-------------|-|-|---+       |   |   |     | | | | | | 
   | |   |   | | | |   | | |   |     |     |         | |   | |       |   |         | | |   |   |         |   |   |   |       |   | | | | | | | | | |   |   |   | | |           |   |   |     | | | | | | 
   | |   |   | | +-------+ +---|-----|-----|-----------------|-----------+     +---------------|-------------|---------------|-----|-------|---|-+ |   |   |   | | |           |   +-+ |     | | +-+ | | 
   | |   |   | |   |   |       |     |     |         | |   | |       |         |   | | |   |   |         |   |   |   |       |   | | | | | | | |   |   |   |   | | |           |     | |     | |     | | 
   | |   +---|-----|---|---+   |     |     |         | |   | |       |         |   | | |   |   |         |   |   |   |       |   | | | | | | | |   |   |   |   | | |           |     | |     | |     | | 
   | |       | |   |   |   |   |     |     |         | |   | |       |         |   | | |   |   |         |   |   |   |       |   | | | | | | | |   |   |   |   | | |           |     | |     | |     | | 
   | |       | +---+ +---+ | +-|-----|-----|---------------|-|-------------------------|---|---------------------------------|-----|-|-----|-|-|---|-------|-------|-----------|-----|---------------+ | 
   | |       |       | | | | | |     |     |         | |   | |       |         |   | | |   |   |         |   |   |   |       |   | | | | | | | |   |   |   |   | | |           |     | |     | |       | 
   | |       |       | | | | | |     |     |         | |   | |       |         |   | | |   +---|---------|-------|---|-+     |   | | | | | | | |   |   |   |   | | | +-+       |   +---|-----|-+       | 
   | |       |       | | | | | |     |     |         | |   | |       |         |   | | |       |         |   |   |   | |     |   | | | | | | | |   |   |   |   | | | | |       |   | | |     |         | 
   | |       |       | | | | | |     |     |         | |   | |       |         |   | | +-------------------------|---|-|---------|-|---|-|-|-|-|-----------|---|---|---|-------|---|-|-|-----|-+       | 
   | |       |       | | | | | |     |     |         | |   | |       |         |   | |         |         |   |   |   | |     |   | | | | | | | |   |   |   |   | | | | |       |   | | |     | |       | 
   | |       +-+     | | | | | |     |     |         | +-----+       |         |   | |         |         +-------------|-----|-----|-|-------|-----|-----------|-+ | | |       |   | | |     | |       | 
   | |         |     | | | | | |     |     |         |     |         |         |   | |         |             |   |   | |     |   | | | | | | | |   |   |   |   |   | | |       |   | | |     | |       | 
   | |         |     | | | | | |     |     |         |     |         |         |   | |         |             |   |   | |     |   | | | | | | | |   |   |   +---|---|---|-----------+ | |     | |       | 
   | |         |     | | | | | |     |     |         |     |         |         |   | |         |             |   |   | |     |   | | | | | | | |   |   |       |   | | |       |     | |     | |       | 
   | |         |     | | | | | |   +-|-----+   +-----|-----|-------------------|-----------------------------|-------|-|-----|---|---|---|-------------|-------|---|-|---------|-+   | |     | | +-+   | 
   | |         |     | | | | | |   | |         |     |     |         |         |   | |         |             |   |   | |     |   | | | | | | | |   |   |       |   | | |       | |   | |     | | | |   | 
   | |         |     | | | | | |   | |         |     |     |         |         |   | |   +-------------------|---------------------|---|---|-|-|-------|-------|-----|---------|-----|-----------+ |   | 
   | |         |     | | | | | |   | |         |     |     |         |         |   | |   |     |             |   |   | |     |   | | | | | | | |   |   |       |   | | |       | |   | |     | |   |   | 
 +---|---------------|---|-|-|-|---|-|---------|-----|---------------|---------|---------|-------------------|---|-----|-------+ | | | | | | | |   |   |       | +-|-|-----+   | |   | |     | |   |   | 
 | | |         |     | | | | | |   | |         |     |     |         |         |   | |   |     |             |   |   | |     | | | | | | | | | |   |   |       | | | | |   |   | |   | |     | |   |   | 
 | | |         |     | | | | | |   | |         |     |     |         |   +-----|---------------|-----------------|---|-|-------|-|---|-+ | | +-----|-----+     | | | | |   |   | |   | |     | |   |   | 
 | | |         |     | | | | | |   | |         |     |     |         |   |     |   | |   |     |             |   |   | |     | | | | |   | |   |   |   | |     | | | | |   |   | |   | |     | |   |   | 
 | | |         |     | | | | | |   | |     +---------|-----|-------------|-----|---------|-----|-----------------|---|---------|-----|---------|---|-----------|-+ | | |   |   | |   | |     | |   +-+ | 
 | | |         |     | | | | | |   | |     |   |     |     |         |   |     |   | |   |     |             |   |   | |     | | | | |   | |   |   |   | |     |   | | |   |   | |   | |     | |     | | 
 | | |         |     | | | | | |   | |     |   |     |     |     +-----------------------|-------------------|---|---|-|-------|-------------------|-----|-------------|-------+ |   | |   +-----+   | | 
 | | |         |     | | | | | |   | |     |   |     |     |     |   |   |     |   | |   |     K             |   |   | |     | | | | |   | |   |   |   | |     |   | | |   |     |   | |   | | | |   | | 
 | | |         | +-------+ | | | +---|---------|-----------|-------------------------|--W--------------------|-------|-|-----|-|-|-|-----|-|-+ |   |   | |     |   | | |   |     |   | |   | | | |   | | 
 | | |         | |   | |   | | | | | |     |   |     |     |     |   |   |     |   | |   |     |             |   |   | |     | | | | |   | | | |   |   | |     |   | | |   |     |   | |   | | | |   | | 
 | | |         | |   | |   | | | | | |     |   |     | +---|-----|---|---------|---|-|---|---------------+   |   |   | |     | | | | |   | | | |   |   | |     |   | | |   |     |   | |   | | | |   | | 
 | | |         | |   | |   | | | | | |     |   |     | |   |     |   |   |     |   | |   |     |         |   |   |   | |     | | | | |   | | | |   |   | |     |   | | |   |     |   | |   | | | |   | | 
 | | |         | |   | |   | | | | | |     |   |     | |   |     |   |   |     |   | |   |     |         |   |   |   | |     | | | | |   | | | |   |   | |     |   | | |   |     |   | |   | | | |   | | 
 | | |         | |   | |   | | | | | |     |   |     | |   |     |   |   |     |   | |   |     |         |   |   |   | |     | | | | |   | | | |   |   | |     |   | | |   |     |   | |   | | | |   | | 
 | | |         | |   | |   +-|-|---|-|---------|-----|-----------|---|-------------|-|---|-----|-----------------|---|-|-------------------|-|-------+ | |     |   | +-|---|-----|---|-|---|---|---+ | | 
 | | |         | |   | |     | | | | |     |   |     | |   |     |   |   |     |   | |   |     |         |   |   |   | |     | | | | |   | | | |   | | | |     |   |   |   |     |   | |   | | | | | | | 
 | | |         +-+   | |   +-|---|---------|---------|-|---|-----|---|---|-----|---------|-----|-----------------------|-------|---|-|---|-|-|-|-----|---|-----|-------|---+     |   | |   | | | | | | | 
 | | |               | |   | | | | | |     |   |     | |   |     |   |   |     |   | |   |     |         |   |   |   | |     | | | | |   | | | |   | | | |     |   |   |         |   | |   | | | | | | | 
 | | |               | | +---|---|-------------------------|-----|---|---------|-------------------------+   |   |   | |     | | | | |   | | | +-----|-|-|-----|-------|-----+   |   | |   | | | | | | | 
 | | |               | | | | | | | | |     |   |     | |   |     |   |   |     |   | |   |     |             |   |   | |     | | | | |   | | |     | | | |     |   |   |     |   |   | |   | | | | | | | 
 | | |               | | | | | | | | |     |   |     | |   |     |   |   |     |   | |   |     | +-----------|-----------------|-|-|-|-+ | | |     | | | |     |   |   |     |   |   | |   | | | | | | | 
 | | |               | | | | | | | | |     |   |     | |   |     |   |   |     |   | |   |     | |           |   |   | |     | | | | | | | | |     | | | |     |   |   |     |   |   | |   | | | | | | | 
 | | |               | | | | | | | | |     |   |     | |   |     |   |   |     |   +-----+     | |           |   |   | |     | | | | | | | | |     | | | |     |   |   |     |   |   | |   | | | | | | | 
 | | |               | | | | | | | | |     |   |     | |   |     |   |   |     |     |         | |           |   |   | |     | | | | | | | | |     | | | |     |   |   |     |   |   | |   | | | | | | | 
 | | |           +---|-|---|---------------|---------|-|---|-----|---|---|-----|-----|---+     | |           |   |   | |     | | | | | | | | |     | | | |     |   +---------------+ | |   | | | | | | | 
 | | |           |   | | | | | | | | |     |   |     | |   |     |   |   |     |     |   |     | |           |   |   | |     | | | | | | | | |     | | | |     |       |     |   | | | |   | | | | | | | 
 | | |           |   +-------|-+ | | |     |   |     | |   |     |   |   |     |     |   |     | |           |   |   | |     | | | | | | | | |     | | | |     |       |     |   | | | |   | | | | | | | 
 | | |           |     | | | |   | | |     |   |     | |   |     |   |   |     |     |   |     | |           |   |   | |     | | | | | | | | |     | | | |     |       |     |   | | | |   | | | | | | | 
 | | |     +-----------|-|-|-----|---------|---|---------------------|---|-----------|---|-------|-------------------|-+     | | | | | | | | |     | | | |     |       |     |   | | | |   | | | | | | | 
 | | |     |     |     | | | |   | | |     |   |     | |   |     |   |   |     |     |   |     | |           |   |   |       | | | | | | | | |     | | | |     |       |     |   | | | |   | | | | | | | 
 | | |     |   +-|-----|-|-|---------|---------------|-----|-----|---|---------|-----|---|-------|-------------------|-----------|-----|-|---|-----|---|-|-----|-------|---------+ | | |   | | | | +-+ | 
 | | |     |   | |     | | | |   | | |     |   |     | |   |     |   |   |     |     |   |     | |           |   |   |       | | | | | | | | |     | | | |     |       |     |     | | |   | | | |     | 
 | | +---------|---------|---+   | | |     |   |     | |   |     |   |   |     |     |   |     | |           |   |   |       | | | | | | | | |     | | | |     |       |     |     | | |   | | | |     | 
 | |       |   | |     | | |     | | |     |   |     | |   |     |   |   |     |     |   |     | |           |   |   |       | | | | | | | | |     | | | |     |       |     |     | | |   | | | |     | 
 | | +-----|---|-+   +-|---+     | | |     |   |     | |   |     +-------|---------------------|-|-------+   |   |   |       | | | | | | | | |     | | | |     |       |     |     | | |   | | | |     | 
 | | |     |   |     | | |       | | |     |   |     | |   |         |   |     |     |   |     | |       |   |   |   |       | | | | | | | | |     | | | |     |       |     |     | | |   | | | |     | 
 | | |     |   |     +-|-----+   | | |     |   |     | |   |         |   |     |     |   |     | |       |   |   |   |       | +-|-|-+ | +---------|---|---+   |       |     |     | | |   | | | |     | 
 | | |     |   |       | |   |   | | |     |   |     | |   |         |   |     |     |   |     | |       |   |   |   |       |   | |   |   | |     | | | | |   |       |     |     | | |   | | | |     | 
 | | +-----------------|-|-------|-+ |     |   |     | |   |         |   |     |     |   |     | |       | +-|-------|-----------|---------|-|---------|---+   |       |     |     | | |   | | | |     | 
 | |       |   |       | |   |   |   |     |   |     | |   |         |   |     |     |   |     | |       | | |   |   |       |   | |   |   | |     | | | |     |       |     |     | | |   | | | |     | 
 | |       |   |       | |   |   |   |     |   |     | |   |         |   |     +-----|---|---------------------------|-------------+   |   | |     | | | |     |       |     |     | | |   | | | |     | 
 | |       |   |       | |   |   |   |     |   |     | |   |         |   |           |   |     | |       | | |   |   |       |   |     |   | |     | | | |     |       |     |     | | |   | | | |     | 
 | | +-----|---|-------|-|---|-------|---------|-----|-|---|-------------|-----------------------------------|---------------|---------|-------------+ | |     |       |     |     | | |   | | | |     | 
 | | |     |   |       | |   |   |   |     |   |     | |   |         R   |           |   |     | |       | | |   |   |       |   |     |   | |     |   | |     |       |     |     | | |   | | | |     | 
 | | |     |   |     +-|-|-------|---------|---|-------|---------------------------------------|-|-------|-|-|---------------|---|---------|-|-----|---|---------------|-+   |     | | |   | | | |     | 
 | | |     |   |     | | |   |   |   |     |   |     | |   |         |   |           |   |     | |       | | |   |   |       |   |     |   | |     |   | |     |       | |   |     | | |   | | | |     | 
 | | |     |   |     +-|-|---|-------------|---|-------|-------------+   |           |   |   +-|-|-------|-|-|---|---------------------|---+ |     |   | |     |       | |   |     | | |   | | | | +-+ | 
 | | |     |   |       | |   |   |   |     |   |     | |   |             |           |   |   | | |       | | |   |   |       |   |     |     |     |   | |     |       | |   |     | | |   | | | | | | | 
 | +-|-----|-------------------------------|---|-----|-|---------------------------------|---+ | | +-----|-|-|---|---|-----------------|-----------+   | |     |       | |   |     | | |   | | | | | | | 
 |   |     |   |       | |   |   |   |     |   |     | |   |             |           |   |     | | |     | | |   |   |       |   |     |     |         | |     |       | |   |     | | |   | | | | | | | 
 |   |     |   | +-----------|---|---|-----|-----------|---|-------------|-----------|---|-----+ | +-------|-|---|---|---------------------------------|-------|-----+ | | +---+   | | |   | | | | | | | 
 |   |     |   | |     | |   |   |   |     |   |     | |   |             |           |   |       |       | | |   |   |       |   |     |     |         | |     |     | | | | | |   | | |   | | | | | | | 
 |   |     |   | |     | |   |   |   |     |   |     | |   |             |           |   |   +-------------------------------|---|---------------+ +-+ | |     |     | | | | | |   | | |   | | | | | | | 
 |   |     |   | |     | |   |   |   |     |   |     | |   |             |           |   |   |   |       | | |   |   |       |   |     |     |   | | | | |     |     | | | | | |   | | |   | | | | | | | 
 |   |     |   | |     | |   |   |   |     |   |     | |   |             |           |   |   |   |       | | |   |   |       |   |     |     | +---|-+ | |     |     | | | | | |   | | |   | | | | | | | 
 |   |     |   | |     | |   |   |   |     |   |     | |   |             |           |   |   |   |       | | |   |   |       |   |     |     | | | |   | |     |     | | | | | |   | | |   | | | | | | | 
 |   |     |   | |     | |   |   | +-----------------|-|---|-------------+ +-+       |   |   |   |       | | |   |   |       |   |     |     | | | |   | |     |     | | | | | |   | | |   | | | | | | | 
 |   |     |   | |     | |   |   | | |     |   |     | |   |               | |       |   |   |   |       | | |   |   |       |   |     |     | | | |   | |     |     | | | | | |   | | |   | | | | | | | 
 |   |     |   | |     | |   +-----|-----------|-----|-----------+         | |       |   |   |   |       | | |   |   |       |   |     |     | | | |   | |     |     | | | | | |   | | |   | | | | | | | 
 |   |     |   | |     | |       | | |     |   |     | |   |     |         | |       |   |   |   |       | | |   |   |       |   |     |     | | | |   | |     |     | | | | | |   | | |   | | | | | | | 
 | +-|-----|---------+ | |       | | |     |   |     | |   |     |         | |       |   |   |   |       | | |   |   |       |   |     |     | | | |   | |     |     | | | | | |   | | | +-+ | | | | | | 
 | | |     |   | |   | | |       | | |     |   |     | |   |     |         | |       |   |   |   |       | | |   |   |       |   |     |     | | | |   | |     |     | | | | | |   | | | |   | | | | | | 
 | | |     |   | |   | | |       | | |     |   |     | |   |     |         | |       |   |   |   |       | | |   |   |       |   |     |     | | | |   | |     |     | | | | | |   | | | |   | | | | | | 
 | | |     |   | |   | | |       | | |     |   |     | |   |     |         | |       |   |   |   |       | | |   |   |       |   |     |     | | | |   | |     |     | | | | | |   | | | |   | | | | | | 
 +---|-----|-----|-----|-|-------+ | |     |   |     | |   |   +-|---------|-|-----------|-------|-------|-------|---|-------|---|-----|---------|-----|-+     | +-+ | | +-+ | |   | | | |   +-|-+ | | | 
   | |     |   | |   | | |         | |     |   |     | |   |   | |         | |       |   |   |   |       | | |   |   |       |   |     |     | | | |   |       | | | | |     | |   | | | |     |   | | | 
 +---|-----|-----+   | | |         | | +---|---|-------|---|-----|---------|-|---------------|---|-------|-|-|---|---------------|-----|-----|-|-------|-------|---|-----+   | |   | | | |     |   | | | 
 | | |     |   |     | | |         | | |   |   |     | |   |   | |         | |       |   |   |   |       | | |   |   |       |   |     |     | | | |   |       | | | | | |   | |   | | | |     |   | | | 
 | | |     |   |     | | |         | | |   |   |     | |   |   | |         | |       |   |   |   |       | | |   |   |       |   |     |     | | | |   |       | | | | | |   | |   | | | |     |   | | | 
 | | |     |   |     | | |         | | |   |   |     | |   |   | |         | |       |   |   |   |       | | |   |   |       |   |     |     | | | |   |       | | | | | |   | |   | | | |     |   | | | 
 | | |     |   |     | | |         | | |   |   |     | |   |   | |         | |       |   |   |   |       | | |   |   |       |   |     |     | | | |   |       | | | | | |   | |   | | | |     |   | +-+ 
 | | |     |   |     | | |         | | |   |   |     | |   |   | |         | |       |   |   |   |       | | |   |   |       |   |     |     | | | |   |       | | | | | |   | |   | | | |     |   |     
 | | |     |   |     | | |         | | |   |   |     | |   |   +-|---------|-------+ |   | +-|---|-------|-------|-----------|---------|-----+ | | |   |       | | | | | |   | |   | | | |     | +-|---+ 
 | | |     |   |     | | |         | | |   |   |     | |   |     |         | |     | |   | | |   |       | | |   |   |       |   |     |       | | |   |       | | | | | |   | |   | | | |     | | |   | 
 | | |     |   |     | | |         | | |   |   |     | |   |     |         | |     | |   | | |   |       | | |   |   |       |   |     |       +-|-|-------+   | | | | | +---------|-----|-----|-+ |   | 
 | | |     |   |     | | |         | | |   |   |     | |   |     |         | |     | |   | | |   |       | | |   |   |       |   |     |         | |   |   |   | | | | |     | |   | | | |     |   |   | 
 | | |     |   |     | | |         | | |   | +---------|---------|---------|--Q------|-------------------|-----------------------------|---------|-----|---|---|---|-|---+   | |   | | | |     |   |   | 
 | | |     |   |     | | |         | | |   | | |     | |   |     |         | |     | |   | | |   |       | | |   |   |       |   |     |         | |   |   |   | | | | | |   | |   | | | |     |   |   | 
 | | |     |   |   +-|-----------------|-----|-|-----------------|---------+ |     | |   | | |   |       | | |   |   |       |   |     |         | |   |   |   | | | | | |   | |   | | | |     |   |   | 
 | | |     |   |   | | | |         | | |   | | |     | |   |     |           |     | |   | | |   |       | | |   |   |       |   |     |         | |   |   |   | | | | | |   | |   | | | |     |   |   | 
 | | |     |   |   | | | |         +---|---|-|-+     | |   |     |           |     +-----|-|-|-+ |       | | |   |   |       |   |     |         | |   +---|-------|---+ |   | |   | | | |     |   |   | 
 | | |     |   |   | | | |           | |   | |       | |   |     |           |       |   | | | | |       | | |   |   |       |   |     |         | |       |   | | | |   |   | |   | | | |     |   |   | 
 | | |     +-----------|-|-----------|-|-+ | |       | +---|-----|-----------|-------|-------------------|-------------------|---------|-------------------|---|-|-------+   | |   +-|-+ |     |   |   | 
 | | |         |   | | | |           | | | | |       |     |     |           |       |   | | | | |       | | |   |   |       |   |     |         | |       |   | | | |       | |     |   |     |   |   | 
 | | |         |   | | | |           | | +-----------------|-----|-----------------------|-|-----+       +----I--|-----------|-----------------------------|-----|-+ |       | |     |   |     |   |   | 
 | | |         |   | | | |           | |   | |       |     |     |           |       |   | | | |           | |   |   |       |   |     |         | |       |   | |   |       | |     |   |     |   |   | 
 | | |         |   | | | |           | |   | |       |     |     |           |       |   | | | |           | |   |   |       |   |   +-|-----------|---------------+ |       | |     |   |     |   |   | 
 | | |         |   | | | |           | |   | |       |     |     |           |       |   | | | |           | |   |   |       |   |   | |         | |       |   | | | |       | |     |   |     |   |   | 
 | | | +-+     | +---|---|-----------|-----|-|-------------|-----|-----------|---------------|-------------|---------+       |   |   | |         | |       |   | | | |       | |     |   |     |   |   | 
 | | | | |     | | | | | |           | |   | |       |     |     |           |       |   | | | |           | |   |           |   |   | |         | |       |   | | | |       | |     |   |     |   |   | 
 | | | | |     | | | | +-|-----------|-|---|-|-------------|-------------------------|---|-|-|-|---------+ | |   |           |   |   | |         | +-------|---|-|---|-------|-|---+ |   |     |   |   | 
 | | | | |     | | | |   |           | |   | |       |     |     |           |       |   | | | |         | | |   |           |   |   | |         |         |   | | | |       | |   | |   |     |   |   | 
 | | | | |     | | | |   |       +---+ |   | |       |     |     |           |       |   | | | |         | | |   |           |   |   | |         |         | +-----+ |       | |   +-|-----------------+ 
 | | | | |     | | | |   |       |     |   | |       |     |     |           |       |   | | | |         | | |   |           |   |   | |         |         | | | |   |       | |     |   |     |   |     
 | | | | |     +-+ +-------------|---+ |   | |       |     |     |           |       |   | | | |         | | |   |           |   |   | +---------------------+ | |   |       | |   +-----+     |   |     
 | | | | |           |   |       |   | |   | |       |     |     |           |       |   | | | |         | | |   |           |   |   |           |         |   | |   |       | |   | |         |   |     
 | | | | |           |   |       |   | +-+ | |       |     |     |           |       |   | | | |         | | |   |           |   |   |           |         |   | |   |       | |   | |         |   |     
 | | | | |           |   |       |   |   | | |       |     |     |           |       |   | | | |         | | |   |           |   |   |           |         |   | |   |       | |   | |         |   |     
 | | | | |           |   |       |   |   | +---------|---+ |     |           |       |   | | | |         | | |   |           |   |   |           |         |   | |   |       | |   | |         |   |     
 | | | | |           |   |       |   |   |   |       |   | |     |           |       |   | | | |         | | |   |           |   |   |           |         |   | |   |       | |   | |         |   |     
 | | | | |           |   |       |   |   |   |       |   | |     |           |       |   | | | |         | | |   |           |   |   |           |         |   | |   |       | |   | |         |   |     
 | | | | |           |   |       |   |   |   |       |   | |     |           |       |   | | | |         | | |   |           |   |   |           |         |   | |   |       | |   | |         |   |     
 | | | | |           |   |       |   |   |   |       |   | |     |           |       |   | | | |         | | |   |           |   |   |           |         |   | |   |       | |   | |         |   |     
 | | | | |           |   |       |   |   |   |       |   | |     |           |       |   | | | |         | | |   |           |   |   |           |         |   | |   |       | |   | |         |   |     
 | | | | | +---------|---|-------|-----------|-----------|-|-----|-----------|-------+   | | | |   +-------|-----|-----------|-------|-----------|---------|-----|---+       | |   | |         |   |     
 | | | | | |         |   |       |   |   |   |       |   | |     |           |           | | | |   |     | | |   |           |   |   |           |         |   | |           | |   | |         |   |     
 | | | | | | +-------+   |       |   |   |   |       |   | |     +-----------|-----------|-----|---|-----|-|-----|-----+     +---|---------------|---------+   +-------------|-----+ |         |   |     
 | | | | | | |           |       |   |   |   |       |   | |                 |           | | | |   |     | | |   |     |         |   |           |               |           | |     |         |   |     
 | | | | | | |           |       +-+ |   |   |       |   | |                 |           | | | |   |     | | |   |     |         |   |           |               |         +---|-+   |         |   |     
 | | | | | | |           |         | |   |   |       |   | |                 |           | | | |   |     | | |   |     |         |   |           |               |         | | | |   |         |   |     
 | | | | | | |     +---------------------|---|-------|-------------------------------------|-------|-------|-+   |     |         |   |           |               |         | | | |   |         |   |     
 | | | | | | |     |     |         | |   |   |       |   | |                 |           | | | |   |     | |     |     |         |   |           |               |         | M | |   |         |   |     
 +-+ | +---|-------------------------|---|---|-------------------------------------------|---|-------------------------------------------+       |           +-------+     | | | |   |         |   |     
     |   | | |     |     |         | |   |   |       |   | |                 |           | | | |   |     | |     |     |         |   |   |       |           |   |   |     | | | |   |         |   |     
   +---------+     |     |         | |   |   |       +-----------------------|-----------+ | | |   |     | |     |     |         |   |   |       |           |   |   |     | | | |   |         |   |     
   | |   | |       |     |         | |   |   |           | |                 |             | | |   |     | |     |     |         |   |   |       |           |   |   |     | | | |   |         |   |     
   | |   | |       |     |         | |   |   |           | |                 |             +-|-|---|-----|-+     |     |         |   |   |       |           |   |   |     | | | |   |         |   |     
   | |   | |       |     |         | |   |   |           | |                 |               | |   |     |       |     |         |   |   |       |           |   |   |     | | | |   |         |   |     
   | |   | |       +-----------------+   |   |           | |   +-----------------------------|-----|-----|-------|-----+         |   |   |       |           |   |   |     | | | |   |         |   |     
   | |   | |             |         |     |   |           | |   |             |               | |   |     |       |               |   |   |       |           |   |   |     | | | |   |         |   |     
 +-+ |   | |             |         |     |   |           +-----|-------------|---------------|-----------|---+   |               |   +---|-------|---------------|---+   +-|-|---+   |         |   |     
 |   |   | |             |         |     |   |             |   |             |               | |   |     |   |   |               |       |       |           |   |       | | | |     |         |   |     
 | +-|-----|-------------|---------|---------|-------------+   |             |               | +---|-----|---|-------------------+       |       |           +---|---------+ | |     |         |   |     
 | | |   | |             |         |     |   |                 |             |               |     |     |   |   |                       |       |               |       |   | |     |         |   |     
 | | |   +-|-----------------------|-+   +---|-----------+     |             |               +-----|-------------------------------------|-------|-----------------------|-----------+         |   |     
 | | |     |             |         | |       |           |     |             |                     |     |   |   |                       |       |               |       |   | |               |   |     
 | | |     | +---------+ |         | +---------------------------------------|--Y------------------|-----|---|-----------------------------------|-------------------+   |   +-----------------+   |     
 | | |     | |         | |         |         |           |     |             |                     |     |   |   |                       |       |               |   |   |     |                   |     
 | | |     | |         | |         |         |           +-----------------------------------------|---------+   |                       |       |               |   |   |     |                   |     
 | | |     | |         | |         |         |                 |             |                     |     |       |                       |       |               |   |   |     |                   |     
 | | |     +-----------|-|---------|---------|-------------+ +-+             +---------------------------------------------------------------------------------------+ +-+     |                   |     
 | | |       |         | |         |         |             | |                                     |     |       |                       |       |               |     |       |                   |     
 | | |       |         +-+         |         |             | +-+ +---------------------------------+     +-------------------------------|-------|---------------+     |       |                   |     
 | | |       |                     |         |             |   | |                                               |                       |       |                     |       |                   |     
 | | |       +-+                   +-----------------------|---|---------------------------------------------------------------------------------|---------------------|-------|-+                 |     
 | | |         |                             |             |   | |                                               |                       |       |                     |       | |                 |     
 +-+ +---------+                             +-------------+ P-+ +-----------------------------------------------+                       +-------+                     +-------+ +-----------------+     
                                                                                                                                                                                                         
"""

enum Direction {
    case up, right, down, left
    
    var symbol : String {
        switch self {
        case .up, .down:
            return "|"
        case .left, .right:
            return "-"
        }
    }
    
    var inverse : Direction {
        switch self {
        case .up:
            return .down
        case .down:
            return .up
        case .left:
            return .right
        case .right:
            return .left
        }
    }
    
    func move(from position: (Int, Int)) -> (Int, Int) {
        switch self {
        case .up:
            return (position.0 - 1, position.1)
        case .down:
            return (position.0 + 1, position.1)
        case .left:
            return (position.0, position.1 - 1)
        case .right:
            return (position.0, position.1 + 1)
        }
    }
}

let maze = input.split(separator: "\n").map { Array($0) }

var position = (0, maze[0].index(of: "|")!)
var direction = Direction.down
var debug = false
var debug2 = false

for i in 0...100000 {
    let (x, y) = position
//    if x == 55 && y == 55 { debug2 = true }
    let symbol = maze[x][y]
    
    if debug { print("\(position) : \(symbol) : \(direction)") }
    switch symbol {
    case " ":
        fatalError("fell off the maze at \(position) step \(i)")
    case "+":
        for d in [Direction.up, Direction.right, Direction.down, Direction.left, nil] {
            guard let nextDirection = d else { fatalError("failed to find valid nextDirection") }
            if direction == nextDirection.inverse {
                if debug2 { print(">>SKIP \(nextDirection) : (backtracking)") }
                continue
            }
            let (nextX, nextY) = nextDirection.move(from: position)
            let nextSymbol = String(maze[nextX][nextY])
            if nextSymbol == nextDirection.symbol {
                direction = nextDirection
                position = (nextX, nextY)
                break
            } else {
                if debug2 { print(">>SKIP \(nextDirection) : \(nextSymbol)") }
            }
        }
    default:
        position = direction.move(from: position)
        if "ABCDEFGHIJKLMNOPQRSTUVWXYZ*".contains(symbol) { print("\(symbol) \(direction)") }
//        if symbol == "P" { debug = true }
    }
}
